<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Xenomai API: include/rtdm/rtdm_driver.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">rtdm</a></div>
<h1>rtdm_driver.h</h1><a href="rtdm__driver_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00025 <span class="preprocessor">#ifndef _RTDM_DRIVER_H</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define _RTDM_DRIVER_H</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#ifndef __KERNEL__</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#error This header is for kernel space usage only. \</span>
00030 <span class="preprocessor">       You are likely looking for rtdm/rtdm.h...</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ */</span>
00032 
00033 <span class="preprocessor">#include &lt;asm/atomic.h&gt;</span>
00034 <span class="preprocessor">#include &lt;linux/list.h&gt;</span>
00035 
00036 <span class="preprocessor">#include &lt;nucleus/xenomai.h&gt;</span>
00037 <span class="preprocessor">#include &lt;nucleus/core.h&gt;</span>
00038 <span class="preprocessor">#include &lt;nucleus/heap.h&gt;</span>
00039 <span class="preprocessor">#include &lt;<a class="code" href="pod_8h.html">nucleus/pod.h</a>&gt;</span>
00040 <span class="preprocessor">#include &lt;nucleus/synch.h&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="rtdm_8h.html">rtdm/rtdm.h</a>&gt;</span>
00042 
00043 <span class="comment">/* debug support */</span>
00044 <span class="preprocessor">#include &lt;nucleus/assert.h&gt;</span>
00045 
00046 <span class="preprocessor">#ifndef CONFIG_XENO_OPT_DEBUG_RTDM</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#define CONFIG_XENO_OPT_DEBUG_RTDM  0</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00049 <span class="preprocessor"></span>
00050 
00051 <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>;
00052 
00053 
<a name="l00066"></a><a class="code" href="group__devregister.html#ga11">00066</a> <span class="preprocessor">#define RTDM_EXCLUSIVE              0x0001</span>
00067 <span class="preprocessor"></span>
<a name="l00069"></a><a class="code" href="group__devregister.html#ga12">00069</a> <span class="preprocessor">#define RTDM_NAMED_DEVICE           0x0010</span>
00070 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="group__devregister.html#ga13">00073</a> <span class="preprocessor">#define RTDM_PROTOCOL_DEVICE        0x0020</span>
00074 <span class="preprocessor"></span>
<a name="l00076"></a><a class="code" href="group__devregister.html#ga14">00076</a> <span class="preprocessor">#define RTDM_DEVICE_TYPE_MASK       0x00F0</span>
00077 <span class="preprocessor"></span>
<a name="l00087"></a><a class="code" href="group__devregister.html#ga15">00087</a> <span class="preprocessor">#define RTDM_CREATED_IN_NRT         0</span>
00088 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="group__devregister.html#ga16">00090</a> <span class="preprocessor">#define RTDM_CLOSING                1</span>
00091 <span class="preprocessor"></span>
<a name="l00094"></a><a class="code" href="group__devregister.html#ga17">00094</a> <span class="preprocessor">#define RTDM_FORCED_CLOSING         2</span>
00095 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="group__devregister.html#ga18">00097</a> <span class="preprocessor">#define RTDM_USER_CONTEXT_FLAG      8   </span><span class="comment">/* first user-definable flag */</span>
00098 
<a name="l00108"></a><a class="code" href="group__devregister.html#ga19">00108</a> <span class="preprocessor">#define RTDM_DEVICE_STRUCT_VER      3</span>
00109 <span class="preprocessor"></span>
<a name="l00111"></a><a class="code" href="group__devregister.html#ga20">00111</a> <span class="preprocessor">#define RTDM_CONTEXT_STRUCT_VER     3</span>
00112 <span class="preprocessor"></span>
<a name="l00114"></a><a class="code" href="group__devregister.html#ga21">00114</a> <span class="preprocessor">#define RTDM_SECURE_DEVICE          0x80000000</span>
00115 <span class="preprocessor"></span>
<a name="l00117"></a><a class="code" href="group__devregister.html#ga22">00117</a> <span class="preprocessor">#define RTDM_DRIVER_VER(major, minor, patch) \</span>
00118 <span class="preprocessor">    (((major &amp; 0xFF) &lt;&lt; 16) | ((minor &amp; 0xFF) &lt;&lt; 8) | (patch &amp; 0xFF))</span>
00119 <span class="preprocessor"></span>
<a name="l00121"></a><a class="code" href="group__devregister.html#ga23">00121</a> <span class="preprocessor">#define RTDM_DRIVER_MAJOR_VER(ver)  (((ver) &gt;&gt; 16) &amp; 0xFF)</span>
00122 <span class="preprocessor"></span>
<a name="l00124"></a><a class="code" href="group__devregister.html#ga24">00124</a> <span class="preprocessor">#define RTDM_DRIVER_MINOR_VER(ver)  (((ver) &gt;&gt; 8) &amp; 0xFF)</span>
00125 <span class="preprocessor"></span>
<a name="l00127"></a><a class="code" href="group__devregister.html#ga25">00127</a> <span class="preprocessor">#define RTDM_DRIVER_PATCH_VER(ver)  ((ver) &amp; 0xFF)</span>
00128 <span class="preprocessor"></span>
00148 <span class="keyword">typedef</span>
<a name="l00149"></a><a class="code" href="group__devregister.html#ga0">00149</a>     int     (*<a class="code" href="group__devregister.html#ga0">rtdm_open_handler_t</a>)   (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00150                                       rtdm_user_info_t          *user_info,
00151                                       <span class="keywordtype">int</span>                       oflag);
00152 
00165 <span class="keyword">typedef</span>
<a name="l00166"></a><a class="code" href="group__devregister.html#ga1">00166</a>     int     (*<a class="code" href="group__devregister.html#ga1">rtdm_socket_handler_t</a>) (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00167                                       rtdm_user_info_t          *user_info,
00168                                       <span class="keywordtype">int</span>                       protocol);
00169 
00181 <span class="keyword">typedef</span>
<a name="l00182"></a><a class="code" href="group__devregister.html#ga2">00182</a>     int     (*<a class="code" href="group__devregister.html#ga2">rtdm_close_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00183                                       rtdm_user_info_t          *user_info);
00184 
00198 <span class="keyword">typedef</span>
<a name="l00199"></a><a class="code" href="group__devregister.html#ga3">00199</a>     int     (*<a class="code" href="group__devregister.html#ga3">rtdm_ioctl_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00200                                       rtdm_user_info_t          *user_info,
00201                                       <span class="keywordtype">int</span>                       request,
00202                                       <span class="keywordtype">void</span>                      *arg);
00203 
00217 <span class="keyword">typedef</span>
<a name="l00218"></a><a class="code" href="group__devregister.html#ga4">00218</a>     ssize_t (*<a class="code" href="group__devregister.html#ga4">rtdm_read_handler_t</a>)   (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00219                                       rtdm_user_info_t          *user_info,
00220                                       <span class="keywordtype">void</span>                      *buf,
00221                                       size_t                    nbyte);
00222 
00237 <span class="keyword">typedef</span>
<a name="l00238"></a><a class="code" href="group__devregister.html#ga5">00238</a>     ssize_t (*<a class="code" href="group__devregister.html#ga5">rtdm_write_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00239                                       rtdm_user_info_t          *user_info,
00240                                       <span class="keyword">const</span> <span class="keywordtype">void</span>                *buf,
00241                                       size_t                    nbyte);
00242 
00258 <span class="keyword">typedef</span>
<a name="l00259"></a><a class="code" href="group__devregister.html#ga6">00259</a>     ssize_t (*<a class="code" href="group__devregister.html#ga6">rtdm_recvmsg_handler_t</a>)(<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00260                                       rtdm_user_info_t          *user_info,
00261                                       <span class="keyword">struct </span>msghdr             *msg,
00262                                       <span class="keywordtype">int</span>                       flags);
00263 
00279 <span class="keyword">typedef</span>
<a name="l00280"></a><a class="code" href="group__devregister.html#ga7">00280</a>     ssize_t (*<a class="code" href="group__devregister.html#ga7">rtdm_sendmsg_handler_t</a>)(<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00281                                       rtdm_user_info_t          *user_info,
00282                                       <span class="keyword">const</span> <span class="keyword">struct </span>msghdr       *msg,
00283                                       <span class="keywordtype">int</span>                       flags);
00286 <span class="keyword">typedef</span>
00287     int     (*rtdm_rt_handler_t)     (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00288                                       rtdm_user_info_t          *user_info,
00289                                       <span class="keywordtype">void</span>                      *arg);
00290 
00291 
<a name="l00295"></a><a class="code" href="structrtdm__operations.html">00295</a> <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a> {
<a name="l00299"></a><a class="code" href="structrtdm__operations.html#z52_0">00299</a>     <a class="code" href="group__devregister.html#ga2">rtdm_close_handler_t</a>            <a class="code" href="structrtdm__operations.html#z52_0">close_rt</a>;
<a name="l00301"></a><a class="code" href="structrtdm__operations.html#z52_1">00301</a>     <a class="code" href="group__devregister.html#ga2">rtdm_close_handler_t</a>            <a class="code" href="structrtdm__operations.html#z52_1">close_nrt</a>;
<a name="l00303"></a><a class="code" href="structrtdm__operations.html#z52_2">00303</a>     <a class="code" href="group__devregister.html#ga3">rtdm_ioctl_handler_t</a>            <a class="code" href="structrtdm__operations.html#z52_2">ioctl_rt</a>;
<a name="l00305"></a><a class="code" href="structrtdm__operations.html#z52_3">00305</a>     <a class="code" href="group__devregister.html#ga3">rtdm_ioctl_handler_t</a>            <a class="code" href="structrtdm__operations.html#z52_3">ioctl_nrt</a>;
<a name="l00311"></a><a class="code" href="structrtdm__operations.html#z53_0">00311</a>     <a class="code" href="group__devregister.html#ga4">rtdm_read_handler_t</a>             <a class="code" href="structrtdm__operations.html#z53_0">read_rt</a>;
<a name="l00313"></a><a class="code" href="structrtdm__operations.html#z53_1">00313</a>     <a class="code" href="group__devregister.html#ga4">rtdm_read_handler_t</a>             <a class="code" href="structrtdm__operations.html#z53_1">read_nrt</a>;
<a name="l00315"></a><a class="code" href="structrtdm__operations.html#z53_2">00315</a>     <a class="code" href="group__devregister.html#ga5">rtdm_write_handler_t</a>            <a class="code" href="structrtdm__operations.html#z53_2">write_rt</a>;
<a name="l00317"></a><a class="code" href="structrtdm__operations.html#z53_3">00317</a>     <a class="code" href="group__devregister.html#ga5">rtdm_write_handler_t</a>            <a class="code" href="structrtdm__operations.html#z53_3">write_nrt</a>;
<a name="l00323"></a><a class="code" href="structrtdm__operations.html#z54_0">00323</a>     <a class="code" href="group__devregister.html#ga6">rtdm_recvmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z54_0">recvmsg_rt</a>;
<a name="l00325"></a><a class="code" href="structrtdm__operations.html#z54_1">00325</a>     <a class="code" href="group__devregister.html#ga6">rtdm_recvmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z54_1">recvmsg_nrt</a>;
<a name="l00327"></a><a class="code" href="structrtdm__operations.html#z54_2">00327</a>     <a class="code" href="group__devregister.html#ga7">rtdm_sendmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z54_2">sendmsg_rt</a>;
<a name="l00329"></a><a class="code" href="structrtdm__operations.html#z54_3">00329</a>     <a class="code" href="group__devregister.html#ga7">rtdm_sendmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z54_3">sendmsg_nrt</a>;
00331 };
00332 
<a name="l00344"></a><a class="code" href="structrtdm__dev__context.html">00344</a> <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> {
<a name="l00346"></a><a class="code" href="structrtdm__dev__context.html#o0">00346</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   <a class="code" href="structrtdm__dev__context.html#o0">context_flags</a>;
<a name="l00348"></a><a class="code" href="structrtdm__dev__context.html#o1">00348</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__dev__context.html#o1">fd</a>;
<a name="l00351"></a><a class="code" href="structrtdm__dev__context.html#o2">00351</a>     atomic_t                        <a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>;
<a name="l00353"></a><a class="code" href="structrtdm__dev__context.html#o3">00353</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a>          *<a class="code" href="structrtdm__dev__context.html#o3">ops</a>;
<a name="l00355"></a><a class="code" href="structrtdm__dev__context.html#o4">00355</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__device.html">rtdm_device</a>              *<a class="code" href="structrtdm__dev__context.html#o4">device</a>;
<a name="l00357"></a><a class="code" href="structrtdm__dev__context.html#o5">00357</a>     <span class="keywordtype">char</span>                            <a class="code" href="structrtdm__dev__context.html#o5">dev_private</a>[0];
00358 };
00359 
00360 <span class="keyword">struct </span>rtdm_dev_reserved {
00361     <span class="keyword">struct </span>list_head                entry;
00362     atomic_t                        refcount;
00363     <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>         *exclusive_context;
00364 };
00365 
<a name="l00373"></a><a class="code" href="structrtdm__device.html">00373</a> <span class="keyword">struct </span><a class="code" href="structrtdm__device.html">rtdm_device</a> {
<a name="l00376"></a><a class="code" href="structrtdm__device.html#o0">00376</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o0">struct_version</a>;
00377 
<a name="l00379"></a><a class="code" href="structrtdm__device.html#o1">00379</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o1">device_flags</a>;
<a name="l00381"></a><a class="code" href="structrtdm__device.html#o2">00381</a>     size_t                          <a class="code" href="structrtdm__device.html#o2">context_size</a>;
00382 
<a name="l00384"></a><a class="code" href="structrtdm__device.html#o3">00384</a>     <span class="keywordtype">char</span>                            <a class="code" href="structrtdm__device.html#o3">device_name</a>[RTDM_MAX_DEVNAME_LEN+1];
00385 
<a name="l00387"></a><a class="code" href="structrtdm__device.html#o4">00387</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o4">protocol_family</a>;
<a name="l00389"></a><a class="code" href="structrtdm__device.html#o5">00389</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o5">socket_type</a>;
00390 
<a name="l00393"></a><a class="code" href="structrtdm__device.html#o6">00393</a>     <a class="code" href="group__devregister.html#ga0">rtdm_open_handler_t</a>             <a class="code" href="structrtdm__device.html#o6">open_rt</a>;
<a name="l00396"></a><a class="code" href="structrtdm__device.html#o7">00396</a>     <a class="code" href="group__devregister.html#ga0">rtdm_open_handler_t</a>             <a class="code" href="structrtdm__device.html#o7">open_nrt</a>;
00397 
<a name="l00400"></a><a class="code" href="structrtdm__device.html#o8">00400</a>     <a class="code" href="group__devregister.html#ga1">rtdm_socket_handler_t</a>           <a class="code" href="structrtdm__device.html#o8">socket_rt</a>;
<a name="l00403"></a><a class="code" href="structrtdm__device.html#o9">00403</a>     <a class="code" href="group__devregister.html#ga1">rtdm_socket_handler_t</a>           <a class="code" href="structrtdm__device.html#o9">socket_nrt</a>;
00404 
<a name="l00406"></a><a class="code" href="structrtdm__device.html#o10">00406</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a>          ops;
00407 
<a name="l00409"></a><a class="code" href="structrtdm__device.html#o11">00409</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o11">device_class</a>;
<a name="l00412"></a><a class="code" href="structrtdm__device.html#o12">00412</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o12">device_sub_class</a>;
<a name="l00414"></a><a class="code" href="structrtdm__device.html#o13">00414</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o13">driver_name</a>;
<a name="l00416"></a><a class="code" href="structrtdm__device.html#o14">00416</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o14">driver_version</a>;
<a name="l00419"></a><a class="code" href="structrtdm__device.html#o15">00419</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o15">peripheral_name</a>;
<a name="l00421"></a><a class="code" href="structrtdm__device.html#o16">00421</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o16">provider_name</a>;
00422 
<a name="l00424"></a><a class="code" href="structrtdm__device.html#o17">00424</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o17">proc_name</a>;
<a name="l00426"></a><a class="code" href="structrtdm__device.html#o18">00426</a>     <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structrtdm__device.html#o18">proc_entry</a>;
00427 
<a name="l00429"></a><a class="code" href="structrtdm__device.html#o19">00429</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o19">device_id</a>;
00430 
<a name="l00432"></a><a class="code" href="structrtdm__device.html#o20">00432</a>     <span class="keyword">struct </span>rtdm_dev_reserved        reserved;
00433 };
00437 <span class="comment">/* --- device registration --- */</span>
00438 
00439 <span class="keywordtype">int</span> <a class="code" href="group__devregister.html#ga9">rtdm_dev_register</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__device.html">rtdm_device</a>* device);
00440 <span class="keywordtype">int</span> <a class="code" href="group__devregister.html#ga10">rtdm_dev_unregister</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__device.html">rtdm_device</a>* device, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poll_delay);
00441 
00442 
00443 <span class="comment">/* --- inter-driver API --- */</span>
00444 
00445 <span class="preprocessor">#define rtdm_open                   rt_dev_open</span>
00446 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_socket                 rt_dev_socket</span>
00447 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_close                  rt_dev_close</span>
00448 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_ioctl                  rt_dev_ioctl</span>
00449 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_read                   rt_dev_read</span>
00450 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_write                  rt_dev_write</span>
00451 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recvmsg                rt_dev_recvmsg</span>
00452 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recv                   rt_dev_recv</span>
00453 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recvfrom               rt_dev_recvfrom</span>
00454 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_sendmsg                rt_dev_sendmsg</span>
00455 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_send                   rt_dev_send</span>
00456 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_sendto                 rt_dev_sendto</span>
00457 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_bind                   rt_dev_bind</span>
00458 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_listen                 rt_dev_listen</span>
00459 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_accept                 rt_dev_accept</span>
00460 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getsockopt             rt_dev_getsockopt</span>
00461 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_setsockopt             rt_dev_setsockopt</span>
00462 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getsockname            rt_dev_getsockname</span>
00463 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getpeername            rt_dev_getpeername</span>
00464 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_shutdown               rt_dev_shutdown</span>
00465 <span class="preprocessor"></span>
00466 <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *<a class="code" href="group__interdrv.html#ga3">rtdm_context_get</a>(<span class="keywordtype">int</span> <a class="code" href="structrtdm__dev__context.html#o1">fd</a>);
00467 
00468 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00469 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__interdrv.html#ga14">rtdm_context_lock</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context)
00470 {
00471     atomic_inc(&amp;context-&gt;<a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>);
00472 }
00473 
00474 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__interdrv.html#ga15">rtdm_context_unlock</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context)
00475 {
00476     atomic_dec(&amp;context-&gt;<a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>);
00477 }
00478 
00479 
00480 <span class="comment">/* --- clock services --- */</span>
00481 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="group__rtdm.html#ga0">nanosecs_abs_t</a> <a class="code" href="group__clock.html#ga0">rtdm_clock_read</a>(<span class="keywordtype">void</span>)
00482 {
00483     <span class="keywordflow">return</span> xnpod_ticks2ns(<a class="code" href="group__pod.html#ga53">xnpod_get_time</a>());
00484 }
00485 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00486 
00487 
00488 <span class="comment">/* --- spin lock services --- */</span>
<a name="l00531"></a><a class="code" href="group__rtdmsync.html#ga20">00531</a> <span class="preprocessor">#define RTDM_EXECUTE_ATOMICALLY(code_block)                                 \</span>
00532 <span class="preprocessor">{                                                                           \</span>
00533 <span class="preprocessor">    spl_t   s;                                                              \</span>
00534 <span class="preprocessor">                                                                            \</span>
00535 <span class="preprocessor">    xnlock_get_irqsave(&amp;nklock, s);                                         \</span>
00536 <span class="preprocessor">    code_block;                                                             \</span>
00537 <span class="preprocessor">    xnlock_put_irqrestore(&amp;nklock, s);                                      \</span>
00538 <span class="preprocessor">}</span>
00539 <span class="preprocessor"></span>
<a name="l00549"></a><a class="code" href="group__rtdmsync.html#ga21">00549</a> <span class="preprocessor">#define RTDM_LOCK_UNLOCKED          SPIN_LOCK_UNLOCKED</span>
00550 <span class="preprocessor"></span>
<a name="l00552"></a><a class="code" href="group__rtdmsync.html#ga0">00552</a> <span class="keyword">typedef</span> spinlock_t                  <a class="code" href="group__rtdmsync.html#ga0">rtdm_lock_t</a>;
00553 
<a name="l00555"></a><a class="code" href="group__rtdmsync.html#ga1">00555</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>               <a class="code" href="group__rtdmsync.html#ga1">rtdm_lockctx_t</a>;
00556 
<a name="l00572"></a><a class="code" href="group__rtdmsync.html#ga22">00572</a> <span class="preprocessor">#define rtdm_lock_init(lock)        spin_lock_init(lock)</span>
00573 <span class="preprocessor"></span>
<a name="l00590"></a><a class="code" href="group__rtdmsync.html#ga23">00590</a> <span class="preprocessor">#define rtdm_lock_get(lock)         rthal_spin_lock(lock)</span>
00591 <span class="preprocessor"></span>
<a name="l00608"></a><a class="code" href="group__rtdmsync.html#ga24">00608</a> <span class="preprocessor">#define rtdm_lock_put(lock)         rthal_spin_unlock(lock)</span>
00609 <span class="preprocessor"></span>
<a name="l00627"></a><a class="code" href="group__rtdmsync.html#ga25">00627</a> <span class="preprocessor">#define rtdm_lock_get_irqsave(lock, context)    \</span>
00628 <span class="preprocessor">    rthal_spin_lock_irqsave(lock, context)</span>
00629 <span class="preprocessor"></span>
<a name="l00647"></a><a class="code" href="group__rtdmsync.html#ga26">00647</a> <span class="preprocessor">#define rtdm_lock_put_irqrestore(lock, context) \</span>
00648 <span class="preprocessor">    rthal_spin_unlock_irqrestore(lock, context)</span>
00649 <span class="preprocessor"></span>
<a name="l00666"></a><a class="code" href="group__rtdmsync.html#ga27">00666</a> <span class="preprocessor">#define rtdm_lock_irqsave(context)              \</span>
00667 <span class="preprocessor">    rthal_local_irq_save(context)</span>
00668 <span class="preprocessor"></span>
<a name="l00685"></a><a class="code" href="group__rtdmsync.html#ga28">00685</a> <span class="preprocessor">#define rtdm_lock_irqrestore(context)           \</span>
00686 <span class="preprocessor">    rthal_local_irq_restore(context)</span>
00687 <span class="preprocessor"></span>
00692 <span class="comment">/* --- Interrupt management services --- */</span>
00698 <span class="keyword">typedef</span> xnintr_t                    rtdm_irq_t;
00699 
<a name="l00706"></a><a class="code" href="group__rtdmirq.html#ga6">00706</a> <span class="preprocessor">#define RTDM_IRQTYPE_SHARED         XN_ISR_SHARED</span>
00707 <span class="preprocessor"></span>
<a name="l00709"></a><a class="code" href="group__rtdmirq.html#ga7">00709</a> <span class="preprocessor">#define RTDM_IRQTYPE_EDGE           XN_ISR_EDGE</span>
00710 <span class="preprocessor"></span>
<a name="l00719"></a><a class="code" href="group__rtdmirq.html#ga1">00719</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__rtdmirq.html#ga1">rtdm_irq_handler_t</a>)(rtdm_irq_t *irq_handle);
00720 
<a name="l00727"></a><a class="code" href="group__rtdmirq.html#ga8">00727</a> <span class="preprocessor">#define RTDM_IRQ_NONE               XN_ISR_NONE</span>
00728 <span class="preprocessor"></span>
<a name="l00729"></a><a class="code" href="group__rtdmirq.html#ga9">00729</a> <span class="preprocessor">#define RTDM_IRQ_HANDLED            XN_ISR_HANDLED</span>
00730 <span class="preprocessor"></span>
<a name="l00749"></a><a class="code" href="group__rtdmirq.html#ga10">00749</a> <span class="preprocessor">#define rtdm_irq_get_arg(irq_handle, type)  ((type *)irq_handle-&gt;cookie)</span>
00750 <span class="preprocessor"></span>
00752 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00753 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga2">rtdm_irq_request</a>(rtdm_irq_t *irq_handle,
00754                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> irq_no,
00755                                    <a class="code" href="group__rtdmirq.html#ga1">rtdm_irq_handler_t</a> handler,
00756                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags,
00757                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *device_name,
00758                                    <span class="keywordtype">void</span> *arg)
00759 {
00760     <a class="code" href="group__intr.html#ga7">xnintr_init</a>(irq_handle, device_name, irq_no, handler, NULL, flags);
00761     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga9">xnintr_attach</a>(irq_handle, arg);
00762 }
00763 
00764 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga3">rtdm_irq_free</a>(rtdm_irq_t *irq_handle)
00765 {
00766     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga10">xnintr_detach</a>(irq_handle);
00767 }
00768 
00769 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga4">rtdm_irq_enable</a>(rtdm_irq_t *irq_handle)
00770 {
00771     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga11">xnintr_enable</a>(irq_handle);
00772 }
00773 
00774 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga5">rtdm_irq_disable</a>(rtdm_irq_t *irq_handle)
00775 {
00776     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga12">xnintr_disable</a>(irq_handle);
00777 }
00778 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00779 
00780 
00781 <span class="comment">/* --- non-real-time signalling services --- */</span>
00782 
00788 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span>                    rtdm_nrtsig_t;
00789 
<a name="l00799"></a><a class="code" href="group__nrtsignal.html#ga1">00799</a> <span class="keyword">typedef</span> void (*<a class="code" href="group__nrtsignal.html#ga1">rtdm_nrtsig_handler_t</a>)(rtdm_nrtsig_t nrt_sig);
00803 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00804 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__nrtsignal.html#ga2">rtdm_nrtsig_init</a>(rtdm_nrtsig_t *nrt_sig,
00805                                    <a class="code" href="group__nrtsignal.html#ga1">rtdm_nrtsig_handler_t</a> handler)
00806 {
00807     *nrt_sig = rthal_alloc_virq();
00808 
00809     <span class="keywordflow">if</span> (*nrt_sig == 0)
00810         <span class="keywordflow">return</span> -EAGAIN;
00811 
00812     rthal_virtualize_irq(rthal_root_domain, *nrt_sig, (rthal_irq_handler_t)handler, NULL, NULL,
00813                          IPIPE_HANDLE_MASK);
00814     <span class="keywordflow">return</span> 0;
00815 }
00816 
00817 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__nrtsignal.html#ga3">rtdm_nrtsig_destroy</a>(rtdm_nrtsig_t *nrt_sig)
00818 {
00819     rthal_free_virq(*nrt_sig);
00820 }
00821 
00822 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__nrtsignal.html#ga4">rtdm_nrtsig_pend</a>(rtdm_nrtsig_t *nrt_sig)
00823 {
00824     rthal_trigger_irq(*nrt_sig);
00825 }
00826 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00827 
00828 
00829 <span class="comment">/* --- task and timing services --- */</span>
00835 <span class="keyword">typedef</span> xnthread_t                  rtdm_task_t;
00836 
<a name="l00842"></a><a class="code" href="group__rtdmtask.html#ga1">00842</a> <span class="keyword">typedef</span> void (*<a class="code" href="group__rtdmtask.html#ga1">rtdm_task_proc_t</a>)(<span class="keywordtype">void</span> *arg);
00843 
00844 
00849 <span class="preprocessor">#define RTDM_TASK_LOWEST_PRIORITY   XNCORE_LOW_PRIO</span>
00850 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_TASK_HIGHEST_PRIORITY  XNCORE_HIGH_PRIO</span>
00851 <span class="preprocessor"></span>
00857 <span class="preprocessor">#define RTDM_TASK_RAISE_PRIORITY    (+1)</span>
00858 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_TASK_LOWER_PRIORITY    (-1)</span>
00859 <span class="preprocessor"></span>
00863 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga2">rtdm_task_init</a>(rtdm_task_t *task, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00864                    <a class="code" href="group__rtdmtask.html#ga1">rtdm_task_proc_t</a> task_proc, <span class="keywordtype">void</span> *arg,
00865                    <span class="keywordtype">int</span> priority, <a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> period);
00866 
00867 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00868 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga3">rtdm_task_destroy</a>(rtdm_task_t *task)
00869 {
00870     <a class="code" href="group__pod.html#ga35">xnpod_delete_thread</a>(task);
00871 }
00872 
00873 <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga9">rtdm_task_join_nrt</a>(rtdm_task_t *task, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poll_delay);
00874 
00875 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga4">rtdm_task_set_priority</a>(rtdm_task_t *task, <span class="keywordtype">int</span> priority)
00876 {
00877     <a class="code" href="group__pod.html#ga40">xnpod_renice_thread</a>(task, priority);
00878     <a class="code" href="group__pod.html#ga43">xnpod_schedule</a>();
00879 }
00880 
00881 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga5">rtdm_task_set_period</a>(rtdm_task_t *task,
00882                                        <a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> period)
00883 {
00884     <span class="keywordflow">if</span> (period &lt; 0)
00885         period = 0;
00886     <span class="keywordflow">return</span> <a class="code" href="group__pod.html#ga51">xnpod_set_thread_periodic</a>(task, XN_INFINITE,
00887                                      xnpod_ns2ticks(period));
00888 }
00889 
00890 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga7">rtdm_task_unblock</a>(rtdm_task_t *task)
00891 {
00892     <span class="keywordtype">int</span> res = <a class="code" href="group__pod.html#ga39">xnpod_unblock_thread</a>(task);
00893 
00894     <a class="code" href="group__pod.html#ga43">xnpod_schedule</a>();
00895     <span class="keywordflow">return</span> res;
00896 }
00897 
00898 <span class="keyword">static</span> <span class="keyword">inline</span> rtdm_task_t *<a class="code" href="group__rtdmtask.html#ga8">rtdm_task_current</a>(<span class="keywordtype">void</span>)
00899 {
00900     <span class="keywordflow">return</span> xnpod_current_thread();
00901 }
00902 
00903 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga6">rtdm_task_wait_period</a>(<span class="keywordtype">void</span>)
00904 {
00905     XENO_ASSERT(RTDM, !xnpod_unblockable_p(), <span class="keywordflow">return</span> -EPERM;);
00906     <span class="keywordflow">return</span> <a class="code" href="group__pod.html#ga52">xnpod_wait_thread_period</a>(NULL);
00907 }
00908 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00909 
00910 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga10">rtdm_task_sleep</a>(<a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> delay);
00911 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga11">rtdm_task_sleep_until</a>(<a class="code" href="group__rtdm.html#ga0">nanosecs_abs_t</a> wakeup_time);
00912 <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga12">rtdm_task_busy_sleep</a>(<a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> delay);
00913 
00914 
00915 <span class="comment">/* --- timeout sequences */</span>
00916 
00917 <span class="keyword">typedef</span> <a class="code" href="group__rtdm.html#ga0">nanosecs_abs_t</a>              rtdm_toseq_t;
00918 
00919 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00920 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga2">rtdm_toseq_init</a>(rtdm_toseq_t *timeout_seq,
00921                                    <a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> timeout)
00922 {
00923     *timeout_seq = <a class="code" href="group__pod.html#ga53">xnpod_get_time</a>() + xnpod_ns2ticks(timeout);
00924 }
00925 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00926 
00927 
00928 <span class="comment">/* --- event services --- */</span>
00929 
00930 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00931     xnsynch_t                       synch_base;
00932 } rtdm_event_t;
00933 
00934 <span class="preprocessor">#define RTDM_EVENT_PENDING          XNSYNCH_SPARE1</span>
00935 <span class="preprocessor"></span>
00936 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00937 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga3">rtdm_event_init</a>(rtdm_event_t *event, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pending)
00938 {
00939     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;event-&gt;synch_base, XNSYNCH_PRIO);
00940     <span class="keywordflow">if</span> (pending)
00941         xnsynch_set_flags(&amp;event-&gt;synch_base, RTDM_EVENT_PENDING);
00942 }
00943 
00944 <span class="keywordtype">void</span> _rtdm_synch_flush(xnsynch_t *synch, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> reason);
00945 
00946 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga4">rtdm_event_destroy</a>(rtdm_event_t *event)
00947 {
00948     _rtdm_synch_flush(&amp;event-&gt;synch_base, <a class="code" href="group__nucleus__status__mode.html#ga11">XNRMID</a>);
00949 }
00950 
00951 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga5">rtdm_event_pulse</a>(rtdm_event_t *event)
00952 {
00953     _rtdm_synch_flush(&amp;event-&gt;synch_base, 0);
00954 }
00955 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00956 
00957 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga7">rtdm_event_wait</a>(rtdm_event_t *event);
00958 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga8">rtdm_event_timedwait</a>(rtdm_event_t *event, <a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> timeout,
00959                          rtdm_toseq_t *timeout_seq);
00960 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga6">rtdm_event_signal</a>(rtdm_event_t *event);
00961 
00962 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga9">rtdm_event_clear</a>(rtdm_event_t *event);
00963 
00964 
00965 <span class="comment">/* --- semaphore services --- */</span>
00966 
00967 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00968     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   value;
00969     xnsynch_t                       synch_base;
00970 } rtdm_sem_t;
00971 
00972 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00973 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga10">rtdm_sem_init</a>(rtdm_sem_t *sem, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> value)
00974 {
00975     sem-&gt;value = value;
00976     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;sem-&gt;synch_base, XNSYNCH_PRIO);
00977 }
00978 
00979 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga11">rtdm_sem_destroy</a>(rtdm_sem_t *sem)
00980 {
00981     _rtdm_synch_flush(&amp;sem-&gt;synch_base, <a class="code" href="group__nucleus__status__mode.html#ga11">XNRMID</a>);
00982 }
00983 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
00984 
00985 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga12">rtdm_sem_down</a>(rtdm_sem_t *sem);
00986 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga13">rtdm_sem_timeddown</a>(rtdm_sem_t *sem, <a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> timeout,
00987                        rtdm_toseq_t *timeout_seq);
00988 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga14">rtdm_sem_up</a>(rtdm_sem_t *sem);
00989 
00990 
00991 <span class="comment">/* --- mutex services --- */</span>
00992 
00993 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00994     xnsynch_t                       synch_base;
00995 } rtdm_mutex_t;
00996 
00997 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
00998 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga15">rtdm_mutex_init</a>(rtdm_mutex_t *mutex)
00999 {
01000     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;mutex-&gt;synch_base, XNSYNCH_PRIO|XNSYNCH_PIP);
01001 }
01002 
01003 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga16">rtdm_mutex_destroy</a>(rtdm_mutex_t *mutex)
01004 {
01005     _rtdm_synch_flush(&amp;mutex-&gt;synch_base, <a class="code" href="group__nucleus__status__mode.html#ga11">XNRMID</a>);
01006 }
01007 
01008 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga17">rtdm_mutex_unlock</a>(rtdm_mutex_t *mutex)
01009 {
01010     XENO_ASSERT(RTDM, !xnpod_asynch_p(), <span class="keywordflow">return</span>;);
01011 
01012     <span class="keywordflow">if</span> (unlikely(<a class="code" href="group__synch.html#ga5">xnsynch_wakeup_one_sleeper</a>(&amp;mutex-&gt;synch_base) != NULL))
01013         <a class="code" href="group__pod.html#ga43">xnpod_schedule</a>();
01014 }
01015 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
01016 
01017 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga18">rtdm_mutex_lock</a>(rtdm_mutex_t *mutex);
01018 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga19">rtdm_mutex_timedlock</a>(rtdm_mutex_t *mutex, <a class="code" href="group__rtdm.html#ga1">nanosecs_rel_t</a> timeout,
01019                          rtdm_toseq_t *timeout_seq);
01020 
01021 
01022 <span class="comment">/* --- utility functions --- */</span>
01023 
01024 <span class="preprocessor">#define rtdm_printk(format, ...)    printk(format, ##__VA_ARGS__)</span>
01025 <span class="preprocessor"></span>
01026 <span class="preprocessor">#ifndef DOXYGEN_CPP </span><span class="comment">/* Avoid static inline tags for RTDM in doxygen */</span>
01027 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *<a class="code" href="group__util.html#ga7">rtdm_malloc</a>(size_t size)
01028 {
01029     <span class="keywordflow">return</span> xnmalloc(size);
01030 }
01031 
01032 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__util.html#ga8">rtdm_free</a>(<span class="keywordtype">void</span> *ptr)
01033 {
01034     xnfree(ptr);
01035 }
01036 
01037 <span class="preprocessor">#ifdef CONFIG_XENO_OPT_PERVASIVE</span>
01038 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="group__util.html#ga3">rtdm_mmap_to_user</a>(rtdm_user_info_t *user_info,
01039                       <span class="keywordtype">void</span> *src_addr, size_t len,
01040                       <span class="keywordtype">int</span> prot, <span class="keywordtype">void</span> **pptr,
01041                       <span class="keyword">struct</span> vm_operations_struct *vm_ops,
01042                       <span class="keywordtype">void</span> *vm_private_data);
01043 <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga4">rtdm_iomap_to_user</a>(rtdm_user_info_t *user_info,
01044                        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> src_addr, size_t len,
01045                        <span class="keywordtype">int</span> prot, <span class="keywordtype">void</span> **pptr,
01046                        <span class="keyword">struct</span> vm_operations_struct *vm_ops,
01047                        <span class="keywordtype">void</span> *vm_private_data);
01048 <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga5">rtdm_munmap</a>(rtdm_user_info_t *user_info, <span class="keywordtype">void</span> *ptr, size_t len);
01049 
01050 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga9">rtdm_read_user_ok</a>(rtdm_user_info_t *user_info,
01051                                     <span class="keyword">const</span> <span class="keywordtype">void</span> __user *ptr, size_t size)
01052 {
01053     <span class="keywordflow">return</span> __xn_access_ok(user_info, VERIFY_READ, ptr, size);
01054 }
01055 
01056 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga10">rtdm_rw_user_ok</a>(rtdm_user_info_t *user_info,
01057                                   <span class="keyword">const</span> <span class="keywordtype">void</span> __user *ptr, size_t size)
01058 {
01059     <span class="keywordflow">return</span> __xn_access_ok(user_info, VERIFY_WRITE, ptr, size);
01060 }
01061 
01062 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga11">rtdm_copy_from_user</a>(rtdm_user_info_t *user_info,
01063                                       <span class="keywordtype">void</span> *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> __user *src,
01064                                       size_t size)
01065 {
01066     <span class="keywordflow">return</span> __xn_copy_from_user(user_info, dst, src, size) ? -EFAULT : 0;
01067 }
01068 
01069 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga12">rtdm_safe_copy_from_user</a>(rtdm_user_info_t *user_info,
01070                                            <span class="keywordtype">void</span> *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> __user *src,
01071                                            size_t size)
01072 {
01073     <span class="keywordflow">return</span> (!__xn_access_ok(user_info, VERIFY_READ, src, size) ||
01074             __xn_copy_from_user(user_info, dst, src, size)) ? -EFAULT : 0;
01075 }
01076 
01077 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga13">rtdm_copy_to_user</a>(rtdm_user_info_t *user_info,
01078                                     <span class="keywordtype">void</span> __user *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src,
01079                                     size_t size)
01080 {
01081     <span class="keywordflow">return</span> __xn_copy_to_user(user_info, dst, src, size) ? -EFAULT : 0;
01082 }
01083 
01084 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga14">rtdm_safe_copy_to_user</a>(rtdm_user_info_t *user_info,
01085                                          <span class="keywordtype">void</span> __user *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src,
01086                                          size_t size)
01087 {
01088     <span class="keywordflow">return</span> (!__xn_access_ok(user_info, VERIFY_WRITE, dst, size) ||
01089             __xn_copy_to_user(user_info, dst, src, size)) ? -EFAULT : 0;
01090 }
01091 
01092 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga15">rtdm_strncpy_from_user</a>(rtdm_user_info_t *user_info,
01093                                          <span class="keywordtype">char</span> *dst,
01094                                          <span class="keyword">const</span> <span class="keywordtype">char</span> __user *src,
01095                                          size_t count)
01096 {
01097     <span class="keywordflow">if</span> (unlikely(!__xn_access_ok(user_info, VERIFY_READ, src, 1)))
01098         <span class="keywordflow">return</span> -EFAULT;
01099     <span class="keywordflow">return</span> __xn_strncpy_from_user(user_info, dst, src, count);
01100 }
01101 <span class="preprocessor">#else </span><span class="comment">/* !CONFIG_XENO_OPT_PERVASIVE */</span>
01102 <span class="comment">/* Define void user&lt;-&gt;kernel services that simply fail */</span>
01103 <span class="preprocessor">#define rtdm_mmap_to_user(...)          ({ -ENOSYS; })</span>
01104 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_munmap(...)                ({ -ENOSYS; })</span>
01105 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_read_user_ok(...)          ({ 0; })</span>
01106 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_rw_user_ok(...)            ({ 0; })</span>
01107 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_copy_from_user(...)        ({ -ENOSYS; })</span>
01108 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_safe_copy_from_user(...)   ({ -ENOSYS; })</span>
01109 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_copy_to_user(...)          ({ -ENOSYS; })</span>
01110 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_safe_copy_to_user(...)     ({ -ENOSYS; })</span>
01111 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_strncpy_from_user(...)     ({ -ENOSYS; })</span>
01112 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* CONFIG_XENO_OPT_PERVASIVE */</span>
01113 
01114 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga16">rtdm_in_rt_context</a>(<span class="keywordtype">void</span>)
01115 {
01116     <span class="keywordflow">return</span> (rthal_current_domain != rthal_root_domain);
01117 }
01118 <span class="preprocessor">#endif </span><span class="comment">/* !DOXYGEN_CPP */</span>
01119 
01120 <span class="keywordtype">int</span> rtdm_exec_in_rt(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context,
01121                     rtdm_user_info_t *user_info, <span class="keywordtype">void</span> *arg,
01122                     rtdm_rt_handler_t handler);
01123 
01124 <span class="preprocessor">#endif </span><span class="comment">/* _RTDM_DRIVER_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Oct 10 22:49:58 2006 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
