<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Xenomai API: include/nucleus/vfile.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>include/nucleus/vfile.h</h1><a href="vfile_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00024"></a>00024 <span class="preprocessor">#ifndef _XENO_NUCLEUS_VFILE_H</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define _XENO_NUCLEUS_VFILE_H</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="preprocessor">#if defined(CONFIG_XENO_OPT_VFILE) || defined(DOXYGEN_CPP)</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;linux/proc_fs.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;linux/seq_file.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;nucleus/types.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">struct </span>xnvfile_directory;
<a name="l00037"></a>00037 <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a>;
<a name="l00038"></a>00038 <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a>;
<a name="l00039"></a>00039 <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a>;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">struct </span>xnvfile {
<a name="l00042"></a>00042         <span class="keyword">struct </span>proc_dir_entry *pde;
<a name="l00043"></a>00043         <span class="keyword">struct </span>xnvfile_directory *parent;
<a name="l00044"></a>00044         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> *lockops;
<a name="l00045"></a>00045         <span class="keywordtype">void</span> *<span class="keyword">private</span>;
<a name="l00046"></a>00046 };
<a name="l00047"></a>00047 
<a name="l00056"></a><a class="code" href="structxnvfile__lock__ops.html">00056</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> {
<a name="l00069"></a>00069         int (*<span class="keyword">get</span>)(<span class="keyword">struct </span>xnvfile *vfile);
<a name="l00077"></a>00077         void (*<a class="code" href="structxnvfile__lock__ops.html#761e2f9fbf035d43c84621082d57b110">put</a>)(<span class="keyword">struct </span>xnvfile *vfile);
<a name="l00078"></a>00078 };
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">/*</span>
<a name="l00081"></a>00081 <span class="comment"> * XXX: struct semaphore is legacy for mutual exclusion, but supported</span>
<a name="l00082"></a>00082 <span class="comment"> * on both 2.4 and 2.6 kernels. Will be changed to mutex when 2.4</span>
<a name="l00083"></a>00083 <span class="comment"> * support is dropped from Xenomai.</span>
<a name="l00084"></a>00084 <span class="comment"> */</span>
<a name="l00085"></a>00085 <span class="keyword">struct </span>xnvfile_hostlock_class {
<a name="l00086"></a>00086         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> ops;
<a name="l00087"></a>00087         <span class="keyword">struct </span>semaphore sem;
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keyword">struct </span>xnvfile_nklock_class {
<a name="l00091"></a>00091         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> ops;
<a name="l00092"></a>00092         spl_t s;
<a name="l00093"></a>00093 };
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="keyword">struct </span>xnvfile_input {
<a name="l00096"></a>00096         <span class="keyword">const</span> <span class="keywordtype">char</span> __user *u_buf;
<a name="l00097"></a>00097         <span class="keywordtype">size_t</span> size;
<a name="l00098"></a>00098         <span class="keyword">struct </span>xnvfile *vfile;
<a name="l00099"></a>00099 };
<a name="l00100"></a>00100 
<a name="l00110"></a><a class="code" href="structxnvfile__regular__ops.html">00110</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__ops.html" title="Regular vfile operation descriptor.">xnvfile_regular_ops</a> {
<a name="l00142"></a>00142         <span class="keywordtype">void</span> *(*begin)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00173"></a>00173         <span class="keywordtype">void</span> *(*next)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00182"></a>00182         void (*<a class="code" href="structxnvfile__regular__ops.html#29ba8b1f5ff72e70411c977397b91877">end</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it);
<a name="l00211"></a>00211         int (*<a class="code" href="structxnvfile__regular__ops.html#c1d48ccaa785342eaa4c80360a560c70">show</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> *it, <span class="keywordtype">void</span> *data);
<a name="l00240"></a>00240         ssize_t (*<a class="code" href="structxnvfile__regular__ops.html#d2b85a790c9a10c62a96f7bd5d3bde6f">store</a>)(<span class="keyword">struct </span>xnvfile_input *input);
<a name="l00241"></a>00241 };
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="keyword">struct </span>xnvfile_regular {
<a name="l00244"></a>00244         <span class="keyword">struct </span>xnvfile entry;
<a name="l00245"></a>00245         <span class="keywordtype">size_t</span> privsz;
<a name="l00246"></a>00246         <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__ops.html" title="Regular vfile operation descriptor.">xnvfile_regular_ops</a> *ops;
<a name="l00247"></a>00247 };
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="keyword">struct </span>xnvfile_regular_template {
<a name="l00250"></a>00250         <span class="keywordtype">size_t</span> privsz;
<a name="l00251"></a>00251         <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__ops.html" title="Regular vfile operation descriptor.">xnvfile_regular_ops</a> *ops;
<a name="l00252"></a>00252         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> *lockops;
<a name="l00253"></a>00253 };
<a name="l00254"></a>00254 
<a name="l00261"></a><a class="code" href="structxnvfile__regular__iterator.html">00261</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__regular__iterator.html" title="Regular vfile iterator.">xnvfile_regular_iterator</a> {
<a name="l00263"></a><a class="code" href="structxnvfile__regular__iterator.html#95c5a521f5bceaff6f76526e854afddf">00263</a>         loff_t <a class="code" href="structxnvfile__regular__iterator.html#95c5a521f5bceaff6f76526e854afddf" title="Current record position while iterating.">pos</a>;
<a name="l00265"></a><a class="code" href="structxnvfile__regular__iterator.html#dd440ac8843af6ef76223e2a8a57f0ec">00265</a>         loff_t <a class="code" href="structxnvfile__regular__iterator.html#dd440ac8843af6ef76223e2a8a57f0ec" title="Highest record position found.">maxpos</a>;
<a name="l00267"></a><a class="code" href="structxnvfile__regular__iterator.html#5ecb6c8a77f673f7dfad6befe0951a72">00267</a>         <span class="keyword">struct </span>seq_file *<a class="code" href="structxnvfile__regular__iterator.html#5ecb6c8a77f673f7dfad6befe0951a72" title="Backlink to the host sequential file supporting the vfile.">seq</a>;
<a name="l00269"></a><a class="code" href="structxnvfile__regular__iterator.html#d2e13d0cd8b63e0cde6e412be74c5346">00269</a>         <span class="keyword">struct </span>xnvfile_regular *<a class="code" href="structxnvfile__regular__iterator.html#d2e13d0cd8b63e0cde6e412be74c5346" title="Backlink to the vfile being read.">vfile</a>;
<a name="l00274"></a><a class="code" href="structxnvfile__regular__iterator.html#bd62397205b2b7e17b63830474036ec7">00274</a>         <span class="keywordtype">char</span> <span class="keyword">private</span>[0];
<a name="l00275"></a>00275 };
<a name="l00276"></a>00276 
<a name="l00287"></a><a class="code" href="structxnvfile__snapshot__ops.html">00287</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__ops.html" title="Snapshot vfile operation descriptor.">xnvfile_snapshot_ops</a> {
<a name="l00328"></a>00328         int (*<a class="code" href="structxnvfile__snapshot__ops.html#2bb1150c2a0f60c6eb979781cbc451c1">rewind</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it);
<a name="l00356"></a>00356         <span class="keywordtype">void</span> *(*begin)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it);
<a name="l00374"></a>00374         void (*<a class="code" href="structxnvfile__snapshot__ops.html#e32a9a16730fa80bfb420111832750e2">end</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *buf);
<a name="l00407"></a>00407         int (*<a class="code" href="structxnvfile__snapshot__ops.html#37a216b44ddfa5c895b7de05da0acd10">next</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *data);
<a name="l00436"></a>00436         int (*<a class="code" href="structxnvfile__snapshot__ops.html#ebfdb0fda48d23b475d93d8945412ab6">show</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *data);
<a name="l00466"></a>00466         ssize_t (*<a class="code" href="structxnvfile__snapshot__ops.html#0a509977acecc8bee5c00dabbfcc56d5">store</a>)(<span class="keyword">struct </span>xnvfile_input *input);
<a name="l00467"></a>00467 };
<a name="l00468"></a>00468 
<a name="l00476"></a><a class="code" href="structxnvfile__rev__tag.html">00476</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> {
<a name="l00478"></a><a class="code" href="structxnvfile__rev__tag.html#a15b64f33679db24160d3c893268437e">00478</a>         <span class="keywordtype">int</span> <a class="code" href="structxnvfile__rev__tag.html#a15b64f33679db24160d3c893268437e" title="Current revision number.">rev</a>;
<a name="l00479"></a>00479 };
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 <span class="keyword">struct </span>xnvfile_snapshot_template {
<a name="l00482"></a>00482         <span class="keywordtype">size_t</span> privsz;
<a name="l00483"></a>00483         <span class="keywordtype">size_t</span> datasz;
<a name="l00484"></a>00484         <span class="keyword">struct </span><a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> *tag;
<a name="l00485"></a>00485         <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__ops.html" title="Snapshot vfile operation descriptor.">xnvfile_snapshot_ops</a> *ops;
<a name="l00486"></a>00486         <span class="keyword">struct </span><a class="code" href="structxnvfile__lock__ops.html" title="Vfile locking operations.">xnvfile_lock_ops</a> *lockops;
<a name="l00487"></a>00487 };
<a name="l00488"></a>00488 
<a name="l00500"></a><a class="code" href="structxnvfile__snapshot.html">00500</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> {
<a name="l00501"></a>00501         <span class="keyword">struct </span>xnvfile entry;
<a name="l00502"></a>00502         <span class="keywordtype">size_t</span> privsz;
<a name="l00503"></a>00503         <span class="keywordtype">size_t</span> datasz;
<a name="l00504"></a>00504         <span class="keyword">struct </span><a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> *tag;
<a name="l00505"></a>00505         <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__ops.html" title="Snapshot vfile operation descriptor.">xnvfile_snapshot_ops</a> *ops;
<a name="l00506"></a>00506 };
<a name="l00507"></a>00507 
<a name="l00514"></a><a class="code" href="structxnvfile__snapshot__iterator.html">00514</a> <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> {
<a name="l00516"></a><a class="code" href="structxnvfile__snapshot__iterator.html#62573366edd906816759fbdd16930522">00516</a>         <span class="keywordtype">int</span> <a class="code" href="structxnvfile__snapshot__iterator.html#62573366edd906816759fbdd16930522" title="Number of collected records.">nrdata</a>;
<a name="l00518"></a><a class="code" href="structxnvfile__snapshot__iterator.html#b3d26fd9ee1e14af1e5d345f589c2f3c">00518</a>         caddr_t <a class="code" href="structxnvfile__snapshot__iterator.html#b3d26fd9ee1e14af1e5d345f589c2f3c" title="Address of record buffer.">databuf</a>;
<a name="l00520"></a><a class="code" href="structxnvfile__snapshot__iterator.html#84d702d0ea1489dca8b4e86e06a856a0">00520</a>         <span class="keyword">struct </span>seq_file *<a class="code" href="structxnvfile__snapshot__iterator.html#84d702d0ea1489dca8b4e86e06a856a0" title="Backlink to the host sequential file supporting the vfile.">seq</a>;
<a name="l00522"></a><a class="code" href="structxnvfile__snapshot__iterator.html#3fb6b2e509206595af45a84926479b5f">00522</a>         <span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *<a class="code" href="structxnvfile__snapshot__iterator.html#3fb6b2e509206595af45a84926479b5f" title="Backlink to the vfile being read.">vfile</a>;
<a name="l00524"></a>00524         void (*<a class="code" href="structxnvfile__snapshot__iterator.html#0c4b28f5a183309699984d859dca9dca" title="Buffer release handler.">endfn</a>)(<span class="keyword">struct </span><a class="code" href="structxnvfile__snapshot__iterator.html" title="Snapshot-driven vfile iterator.">xnvfile_snapshot_iterator</a> *it, <span class="keywordtype">void</span> *buf);
<a name="l00529"></a><a class="code" href="structxnvfile__snapshot__iterator.html#7b01ca175907f4159dfb5201be85df0a">00529</a>         <span class="keywordtype">char</span> <span class="keyword">private</span>[0];
<a name="l00530"></a>00530 };
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="keyword">struct </span>xnvfile_directory {
<a name="l00533"></a>00533         <span class="keyword">struct </span>xnvfile entry;
<a name="l00534"></a>00534 };
<a name="l00535"></a>00535 
<a name="l00536"></a>00536 <span class="keyword">struct </span>xnvfile_link {
<a name="l00537"></a>00537         <span class="keyword">struct </span>xnvfile entry;
<a name="l00538"></a>00538 };
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 <span class="comment">/* vfile.begin()=&gt; */</span>
<a name="l00541"></a>00541 <span class="preprocessor">#define VFILE_SEQ_EMPTY                 ((void *)-1)</span>
<a name="l00542"></a>00542 <span class="preprocessor"></span><span class="comment">/* =&gt;vfile.show() */</span>
<a name="l00543"></a>00543 <span class="preprocessor">#define VFILE_SEQ_START                 SEQ_START_TOKEN</span>
<a name="l00544"></a>00544 <span class="preprocessor"></span><span class="comment">/* vfile.next/show()=&gt; */</span>
<a name="l00545"></a>00545 <span class="preprocessor">#define VFILE_SEQ_SKIP                  2</span>
<a name="l00546"></a>00546 <span class="preprocessor"></span>
<a name="l00547"></a>00547 <span class="preprocessor">#define xnvfile_printf(it, args...)     seq_printf((it)-&gt;seq, ##args)</span>
<a name="l00548"></a>00548 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_write(it, data, len)    seq_write((it)-&gt;seq, (data),(len))</span>
<a name="l00549"></a>00549 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_puts(it, s)             seq_puts((it)-&gt;seq, (s))</span>
<a name="l00550"></a>00550 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_putc(it, c)             seq_putc((it)-&gt;seq, (c))</span>
<a name="l00551"></a>00551 <span class="preprocessor"></span>
<a name="l00552"></a>00552 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> xnvfile_touch_tag(<span class="keyword">struct</span> <a class="code" href="structxnvfile__rev__tag.html" title="Snapshot revision tag.">xnvfile_rev_tag</a> *tag)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554         tag-&gt;<a class="code" href="structxnvfile__rev__tag.html#a15b64f33679db24160d3c893268437e" title="Current revision number.">rev</a>++;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> xnvfile_touch(<span class="keyword">struct</span> <a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *vfile)
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559         xnvfile_touch_tag(vfile-&gt;<a class="code" href="structxnvfile__snapshot.html#7dc6fd57841111fc31fc2a4defb6a573">tag</a>);
<a name="l00560"></a>00560 }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> xnvfile_reg_p(<span class="keyword">struct</span> xnvfile *entry)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564         <span class="keywordflow">return</span> S_ISREG(entry-&gt;pde-&gt;mode);
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> xnvfile_dir_p(<span class="keyword">struct</span> xnvfile *entry)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569         <span class="keywordflow">return</span> S_ISDIR(entry-&gt;pde-&gt;mode);
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> xnvfile_link_p(<span class="keyword">struct</span> xnvfile *entry)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574         <span class="keywordflow">return</span> S_ISLNK(entry-&gt;pde-&gt;mode);
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="preprocessor">#define xnvfile_noentry                 \</span>
<a name="l00578"></a>00578 <span class="preprocessor">        {                               \</span>
<a name="l00579"></a>00579 <span class="preprocessor">                .pde = NULL,            \</span>
<a name="l00580"></a>00580 <span class="preprocessor">                .parent = NULL,         \</span>
<a name="l00581"></a>00581 <span class="preprocessor">                .private = NULL,        \</span>
<a name="l00582"></a>00582 <span class="preprocessor">        }</span>
<a name="l00583"></a>00583 <span class="preprocessor"></span>
<a name="l00584"></a>00584 <span class="preprocessor">#define xnvfile_nodir   { .entry = xnvfile_noentry }</span>
<a name="l00585"></a>00585 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_nolink  { .entry = xnvfile_noentry }</span>
<a name="l00586"></a>00586 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_nofile  { .entry = xnvfile_noentry }</span>
<a name="l00587"></a>00587 <span class="preprocessor"></span>
<a name="l00588"></a>00588 <span class="preprocessor">#define xnvfile_parent(e)               ((e)-&gt;entry.parent)</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_priv(e)                 ((e)-&gt;entry.private)</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span><span class="preprocessor">#define xnvfile_iterator_priv(it)       ((void *)(&amp;(it)-&gt;private))</span>
<a name="l00591"></a>00591 <span class="preprocessor"></span>
<a name="l00592"></a>00592 <span class="keyword">extern</span> <span class="keyword">struct </span>xnvfile_nklock_class xnvfile_nucleus_lock;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="keyword">extern</span> <span class="keyword">struct </span>xnvfile_directory <a class="code" href="group__vfile.html#g7f46f9d1249c5d855b5ead672a0d6ee5" title="Xenomai vfile root directory.">nkvfroot</a>;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <span class="keywordtype">int</span> xnvfile_init_root(<span class="keywordtype">void</span>);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 <span class="keywordtype">void</span> xnvfile_destroy_root(<span class="keywordtype">void</span>);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00601"></a>00601 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00602"></a>00602 <span class="preprocessor">#endif</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>
<a name="l00604"></a>00604 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#gad513ffc19d0ab33ff1722899841a442" title="Initialize a snapshot-driven vfile.">xnvfile_init_snapshot</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00605"></a>00605                           <span class="keyword">struct</span> <a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *vfile,
<a name="l00606"></a>00606                           <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#g82b37f521d867ab9a94b15570210f83f" title="Initialize a regular vfile.">xnvfile_init_regular</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00609"></a>00609                          <span class="keyword">struct</span> xnvfile_regular *vfile,
<a name="l00610"></a>00610                          <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#gdafe22257ce52d6e35698f4f66bb93c7" title="Initialize a virtual directory entry.">xnvfile_init_dir</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00613"></a>00613                      <span class="keyword">struct</span> xnvfile_directory *vdir,
<a name="l00614"></a>00614                      <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="keywordtype">int</span> <a class="code" href="group__vfile.html#g3f28290884ca3c4458ac67e2b1845502" title="Initialize a virtual link entry.">xnvfile_init_link</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *from,
<a name="l00617"></a>00617                       <span class="keyword">const</span> <span class="keywordtype">char</span> *to,
<a name="l00618"></a>00618                       <span class="keyword">struct</span> xnvfile_link *vlink,
<a name="l00619"></a>00619                       <span class="keyword">struct</span> xnvfile_directory *parent);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="keywordtype">void</span> <a class="code" href="group__vfile.html#g5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(<span class="keyword">struct</span> xnvfile *vfile);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 ssize_t <a class="code" href="group__vfile.html#g6a9005ee997d929f7c8940cfcfcab171" title="Read in a data bulk written to the vfile.">xnvfile_get_blob</a>(<span class="keyword">struct</span> xnvfile_input *input,
<a name="l00624"></a>00624                          <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> size);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 ssize_t <a class="code" href="group__vfile.html#ge45ea5410707367c9e032dc36fc30916" title="Read in a C-string written to the vfile.">xnvfile_get_string</a>(<span class="keyword">struct</span> xnvfile_input *input,
<a name="l00627"></a>00627                            <span class="keywordtype">char</span> *s, <span class="keywordtype">size_t</span> maxlen);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 ssize_t <a class="code" href="group__vfile.html#g18746b2aae928c0281ae57ef47086600" title="Evaluate the string written to the vfile as a long integer.">xnvfile_get_integer</a>(<span class="keyword">struct</span> xnvfile_input *input, <span class="keywordtype">long</span> *valp);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="keywordtype">int</span> __vfile_hostlock_get(<span class="keyword">struct</span> xnvfile *vfile);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="keywordtype">void</span> __vfile_hostlock_put(<span class="keyword">struct</span> xnvfile *vfile);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00636"></a>00636 <span class="preprocessor"></span>}
<a name="l00637"></a>00637 <span class="preprocessor">#endif</span>
<a name="l00638"></a>00638 <span class="preprocessor"></span>
<a name="l00639"></a>00639 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00640"></a>00640 <span class="keywordtype">void</span> xnvfile_destroy_snapshot(<span class="keyword">struct</span> <a class="code" href="structxnvfile__snapshot.html" title="Snapshot vfile descriptor.">xnvfile_snapshot</a> *vfile)
<a name="l00641"></a>00641 {
<a name="l00642"></a>00642         <a class="code" href="group__vfile.html#g5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vfile-&gt;<a class="code" href="structxnvfile__snapshot.html#dd056f6de893b3d642983e9455a1cbd8">entry</a>);
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00646"></a>00646 <span class="keywordtype">void</span> xnvfile_destroy_regular(<span class="keyword">struct</span> xnvfile_regular *vfile)
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648         <a class="code" href="group__vfile.html#g5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vfile-&gt;entry);
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00652"></a>00652 <span class="keywordtype">void</span> xnvfile_destroy_dir(<span class="keyword">struct</span> xnvfile_directory *vdir)
<a name="l00653"></a>00653 {
<a name="l00654"></a>00654         <a class="code" href="group__vfile.html#g5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vdir-&gt;entry);
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00658"></a>00658 <span class="keywordtype">void</span> xnvfile_destroy_link(<span class="keyword">struct</span> xnvfile_link *vlink)
<a name="l00659"></a>00659 {
<a name="l00660"></a>00660         <a class="code" href="group__vfile.html#g5429178db74b9dd23378cb8f0942629e" title="Removes a virtual file entry.">xnvfile_destroy</a>(&amp;vlink-&gt;entry);
<a name="l00661"></a>00661 }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663 <span class="preprocessor">#define DEFINE_VFILE_HOSTLOCK(name)                                     \</span>
<a name="l00664"></a>00664 <span class="preprocessor">        struct xnvfile_hostlock_class name = {                          \</span>
<a name="l00665"></a>00665 <span class="preprocessor">                .ops = {                                                \</span>
<a name="l00666"></a>00666 <span class="preprocessor">                        .get = __vfile_hostlock_get,                    \</span>
<a name="l00667"></a>00667 <span class="preprocessor">                        .put = __vfile_hostlock_put,                    \</span>
<a name="l00668"></a>00668 <span class="preprocessor">                },                                                      \</span>
<a name="l00669"></a>00669 <span class="preprocessor">                .sem = __SEMAPHORE_INITIALIZER(name.sem, 1),            \</span>
<a name="l00670"></a>00670 <span class="preprocessor">        }</span>
<a name="l00671"></a>00671 <span class="preprocessor"></span>
<a name="l00672"></a>00672 <span class="preprocessor">#else </span><span class="comment">/* !CONFIG_XENO_OPT_VFILE */</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="preprocessor">#define xnvfile_touch_tag(tag)  do { } while (0)</span>
<a name="l00675"></a>00675 <span class="preprocessor"></span>
<a name="l00676"></a>00676 <span class="preprocessor">#define xnvfile_touch(vfile)    do { } while (0)</span>
<a name="l00677"></a>00677 <span class="preprocessor"></span>
<a name="l00678"></a>00678 <span class="preprocessor">#endif </span><span class="comment">/* !CONFIG_XENO_OPT_VFILE */</span>
<a name="l00679"></a>00679 
<a name="l00682"></a>00682 <span class="preprocessor">#endif </span><span class="comment">/* !_XENO_NUCLEUS_VFILE_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Sep 2 20:38:35 2010 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
