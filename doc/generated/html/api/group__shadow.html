<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Xenomai API: Real-time shadow services.</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xenomai API
   &#160;<span id="projectnumber">2.5.6.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('group__shadow.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Real-time shadow services.</div>  </div>
<div class="ingroups"><a class="el" href="group__nucleus.html">Xenomai nucleus.</a></div></div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Real-time shadow services.:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__shadow.png" border="0" alt="" usemap="#group____shadow"/>
<map name="group____shadow" id="group____shadow">
<area shape="rect" id="node1" href="group__nucleus.html" title="Xenomai nucleus." alt="" coords="7,5,132,35"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="files"></a>
Files</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="shadow_8c.html">shadow.c</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Real-time shadow services. </p>
<br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__shadow.html#ga08736069c2893e0c4b59b7180ffe4079">xnshadow_mark_sig</a> (xnthread_t *thread, unsigned muxid)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark the per-thread per-skin signal condition for the skin whose muxid is <em>muxid</em>.  <a href="#ga08736069c2893e0c4b59b7180ffe4079"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__shadow.html#ga36220a39184a95755f212ee41b108654">xnshadow_clear_sig</a> (xnthread_t *thread, unsigned muxid)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear the per-thrad per-skin signal condition.  <a href="#ga36220a39184a95755f212ee41b108654"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__shadow.html#ga5f631762c7381866d70177afb2ba123b">xnshadow_harden</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Migrate a Linux task to the Xenomai domain.  <a href="#ga5f631762c7381866d70177afb2ba123b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__shadow.html#ga8de86a334ac2c5aeeebccf88fcee03ab">xnshadow_relax</a> (int notify, int reason)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch a shadow thread back to the Linux domain.  <a href="#ga8de86a334ac2c5aeeebccf88fcee03ab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__shadow.html#gaea016c86d43254322f82199bf9e6afb3">xnshadow_map</a> (xnthread_t *thread, xncompletion_t __user *u_completion, unsigned long __user *u_mode)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a shadow thread context.  <a href="#gaea016c86d43254322f82199bf9e6afb3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">xnshadow_ppd_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__shadow.html#ga14c8b586498491f886d7b5335f92c3b1">xnshadow_ppd_get</a> (unsigned muxid)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the per-process data attached to the calling process.  <a href="#ga14c8b586498491f886d7b5335f92c3b1"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>Real-time shadow services. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga36220a39184a95755f212ee41b108654"></a><!-- doxytag: member="shadow.c::xnshadow_clear_sig" ref="ga36220a39184a95755f212ee41b108654" args="(xnthread_t *thread, unsigned muxid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="group__shadow.html#ga36220a39184a95755f212ee41b108654">xnshadow_clear_sig</a> </td>
          <td>(</td>
          <td class="paramtype">xnthread_t *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>muxid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clear the per-thrad per-skin signal condition. </p>
<p>Called with nklock locked irqs off.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>the target thrad </td></tr>
    <tr><td class="paramname">muxid</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga5f631762c7381866d70177afb2ba123b"></a><!-- doxytag: member="shadow.c::xnshadow_harden" ref="ga5f631762c7381866d70177afb2ba123b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__shadow.html#ga5f631762c7381866d70177afb2ba123b">xnshadow_harden</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Migrate a Linux task to the Xenomai domain. </p>
<p>This service causes the transition of "current" from the Linux domain to Xenomai. This is obtained by asking the gatekeeper to resume the shadow mated with "current" then triggering the rescheduling procedure in the Xenomai domain. The shadow will resume in the Xenomai domain as returning from schedule().</p>
<p>Environments:</p>
<p>This service can be called from:</p>
<ul>
<li>User-space thread operating in secondary (i.e. relaxed) mode.</li>
</ul>
<p>Rescheduling: always. </p>

<p>References <a class="el" href="group__nucleus__info__flags.html#gacd09e12fd36001dcc930a01f5b16cbd5">XNATOMIC</a>, and <a class="el" href="group__pod.html#gafd49fb1aa94c5f44f8c23d66a77b5581">xnpod_dispatch_signals()</a>.</p>

<p>Referenced by <a class="el" href="group__shadow.html#gaea016c86d43254322f82199bf9e6afb3">xnshadow_map()</a>.</p>

</div>
</div>
<a class="anchor" id="gaea016c86d43254322f82199bf9e6afb3"></a><!-- doxytag: member="shadow.c::xnshadow_map" ref="gaea016c86d43254322f82199bf9e6afb3" args="(xnthread_t *thread, xncompletion_t __user *u_completion, unsigned long __user *u_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__shadow.html#gaea016c86d43254322f82199bf9e6afb3">xnshadow_map</a> </td>
          <td>(</td>
          <td class="paramtype">xnthread_t *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">xncompletion_t __user *&#160;</td>
          <td class="paramname"><em>u_completion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long __user *&#160;</td>
          <td class="paramname"><em>u_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a shadow thread context. </p>
<p>This call maps a nucleus thread to the "current" Linux task. The priority and scheduling class of the underlying Linux task are not affected; it is assumed that the interface library did set them appropriately before issuing the shadow mapping request.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>The descriptor address of the new shadow thread to be mapped to "current". This descriptor must have been previously initialized by a call to <a class="el" href="group__pod.html#gad71ebccc5b7b3d367f65127a8849c036" title="Initialize a new thread.">xnpod_init_thread()</a>.</td></tr>
    <tr><td class="paramname">u_completion</td><td>is the address of an optional completion descriptor aimed at synchronizing our parent thread with us. If non-NULL, the information <a class="el" href="group__shadow.html#gaea016c86d43254322f82199bf9e6afb3" title="Create a shadow thread context.">xnshadow_map()</a> will store into the completion block will be later used to wake up the parent thread when the current shadow has been initialized. In the latter case, the new shadow thread is left in a dormant state (XNDORMANT) after its creation, leading to the suspension of "current" in the Linux domain, only processing signals. Otherwise, the shadow thread is immediately started and "current" immediately resumes in the Xenomai domain from this service.</td></tr>
    <tr><td class="paramname"></td><td>u_mode is the address of a mode variable in user space that will reflect the current thread mode (primary or secondary). The nucleus will try to update the variable before switching to secondary or after switching from primary mode.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 is returned on success. Otherwise:</dd></dl>
<ul>
<li>-ERESTARTSYS is returned if the current Linux task has received a signal, thus preventing the final migration to the Xenomai domain (i.e. in order to process the signal in the Linux domain). This error should not be considered as fatal.</li>
</ul>
<ul>
<li>-EPERM is returned if the shadow thread has been killed before the current task had a chance to return to the caller. In such a case, the real-time mapping operation has failed globally, and no Xenomai resource remains attached to it.</li>
</ul>
<ul>
<li>-EINVAL is returned if the thread control block does not bear the XNSHADOW bit.</li>
</ul>
<ul>
<li>-EBUSY is returned if either the current Linux task or the associated shadow thread is already involved in a shadow mapping.</li>
</ul>
<p>Environments:</p>
<p>This service can be called from:</p>
<ul>
<li>Regular user-space process.</li>
</ul>
<p>Rescheduling: always. </p>

<p>References <a class="el" href="group__nucleus__state__flags.html#gaabc63b4b55fdf5db7469d4532ed35fd2">XNMAPPED</a>, <a class="el" href="group__pod.html#gad322f6afd62430705486a9036d0b7d66">xnpod_start_thread()</a>, <a class="el" href="group__pod.html#ga767221cf87c198c5dc071e9f597dcb3a">xnpod_suspend_thread()</a>, <a class="el" href="group__nucleus__info__flags.html#ga1ebc292a849f2b9cd19fc89caaa65a3e">XNPRIOSET</a>, <a class="el" href="group__nucleus__state__flags.html#gadf5508cd88c2678ae01dfaf5570c661c">XNRELAX</a>, <a class="el" href="group__nucleus__state__flags.html#gac664c3bae93da4141d2fc8e88a91afd8">XNSHADOW</a>, and <a class="el" href="group__shadow.html#ga5f631762c7381866d70177afb2ba123b">xnshadow_harden()</a>.</p>

</div>
</div>
<a class="anchor" id="ga08736069c2893e0c4b59b7180ffe4079"></a><!-- doxytag: member="shadow.c::xnshadow_mark_sig" ref="ga08736069c2893e0c4b59b7180ffe4079" args="(xnthread_t *thread, unsigned muxid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__shadow.html#ga08736069c2893e0c4b59b7180ffe4079">xnshadow_mark_sig</a> </td>
          <td>(</td>
          <td class="paramtype">xnthread_t *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>muxid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mark the per-thread per-skin signal condition for the skin whose muxid is <em>muxid</em>. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>the target thread; </td></tr>
    <tr><td class="paramname">muxid</td><td>the muxid of the skin for which the signal is marked pending.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>whether rescheduling is needed. </dd></dl>

<p>References <a class="el" href="group__nucleus__state__flags.html#gaabc63b4b55fdf5db7469d4532ed35fd2">XNMAPPED</a>, and <a class="el" href="group__pod.html#gae5f0d19e7a499b9b262f68a43ab545dd">xnpod_unblock_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="ga14c8b586498491f886d7b5335f92c3b1"></a><!-- doxytag: member="shadow.c::xnshadow_ppd_get" ref="ga14c8b586498491f886d7b5335f92c3b1" args="(unsigned muxid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xnshadow_ppd_t* <a class="el" href="group__shadow.html#ga14c8b586498491f886d7b5335f92c3b1">xnshadow_ppd_get</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>muxid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the per-process data attached to the calling process. </p>
<p>This service returns the per-process data attached to the calling process for the skin whose muxid is <em>muxid</em>. It must be called with nklock locked, irqs off.</p>
<p>See xnshadow_register_interface() documentation for information on the way to attach a per-process data to a process.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">muxid</td><td>the skin muxid.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the per-process data if the current context is a user-space process; </dd>
<dd>
NULL otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="ga8de86a334ac2c5aeeebccf88fcee03ab"></a><!-- doxytag: member="shadow.c::xnshadow_relax" ref="ga8de86a334ac2c5aeeebccf88fcee03ab" args="(int notify, int reason)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="group__shadow.html#ga8de86a334ac2c5aeeebccf88fcee03ab">xnshadow_relax</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>notify</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>reason</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Switch a shadow thread back to the Linux domain. </p>
<p>This service yields the control of the running shadow back to Linux. This is obtained by suspending the shadow and scheduling a wake up call for the mated user task inside the Linux domain. The Linux task will resume on return from <a class="el" href="group__pod.html#ga767221cf87c198c5dc071e9f597dcb3a" title="Suspend a thread.">xnpod_suspend_thread()</a> on behalf of the root thread.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">notify</td><td>A boolean flag indicating whether threads monitored from secondary mode switches should be sent a SIGDEBUG signal. For instance, some internal operations like task exit should not trigger such signal.</td></tr>
    <tr><td class="paramname">reason</td><td>The reason to report along with the SIGDEBUG signal.</td></tr>
  </table>
  </dd>
</dl>
<p>Environments:</p>
<p>This service can be called from:</p>
<ul>
<li>User-space thread operating in primary (i.e. harden) mode.</li>
</ul>
<p>Rescheduling: always.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>"current" is valid here since the shadow runs with the properties of the Linux task. </dd></dl>

<p>References <a class="el" href="group__nucleus__info__flags.html#ga5367249995d2f1130a4f40b6b114f52d">XNAFFSET</a>, <a class="el" href="group__pod.html#ga767221cf87c198c5dc071e9f597dcb3a">xnpod_suspend_thread()</a>, <a class="el" href="group__nucleus__info__flags.html#ga1ebc292a849f2b9cd19fc89caaa65a3e">XNPRIOSET</a>, <a class="el" href="group__nucleus__state__flags.html#gadf5508cd88c2678ae01dfaf5570c661c">XNRELAX</a>, <a class="el" href="group__nucleus__state__flags.html#ga73d7b1a4f5a25545ff21140a0598075a">XNROOT</a>, and <a class="el" href="group__nucleus__state__flags.html#gade2e62645781aa1badafd97659cf3473">XNTRAPSW</a>.</p>

<p>Referenced by <a class="el" href="group__posix__thread.html#ga9dd3db5524fccb05a8868b7c33ccaa79">pthread_set_mode_np()</a>, and <a class="el" href="group__pod.html#gaf95cac21ec23e44282461905dd3fc153">xnpod_trap_fault()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
  <div id="nav-path" class="navpath">
    <ul>

    <li class="footer">Generated on Thu Aug 2 2012 09:31:35 for Xenomai API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
