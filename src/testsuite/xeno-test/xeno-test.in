#! @testdir@/xeno-test-run

usage()
{
    cat <<EOF
xeno-test [ -l "load command" ] [ latency options ]

Run a basic test/benchmark of Xenomai on your platform, by first starting a
few unit tests, then running the latency test under the load generated by
"load-command".

By default, the load command is "dohell 900", which will generate load during
15 minutes. To generate a more realistic load see dohell help.

Any other option passed on the command line is passed to the latency test.

Example:
xeno-test -l "dohell -s 192.168.0.5 -m /mnt -l /ltp" -t 2

Will generate load including network load using the server at IP address
192.168.0.5, some I/O under the moint point /mnt, and the LTP testsuite
installed under the /ltp directory, and use the latency test by measuring the
timer irq latency.
EOF
}

if [ "$1" = "-h" -o "$1" = "--help" ]; then
    usage
    exit 0
fi

set -e

arith
check-vdso
clocktest -T 30
switchtest -T 30
cond-torture-native
cond-torture-posix
mutex-torture-native
mutex-torture-posix

start_load

check_alive latency ${1+"$@"}

wait_load
